<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boring AceStream Player</title>
  <script src="mpegts.js"></script>
  <link rel="icon" href="data:,">
</head>
<body>
  <label for="acestreamId">AceStream ID</label>
  <input type="text" id="acestreamId">
  <br><br>

  <video id="videoElement" controls width="800"></video>

  <script>
    const acestreamInput = document.getElementById('acestreamId');
    const videoElement = document.getElementById('videoElement');
    let player = null;
 
    acestreamInput.value = localStorage.getItem('acestreamId') || '';

    acestreamInput.addEventListener('keypress', function(event) {
      event.preventDefault();

      if (event.key === 'Enter' && acestreamId) {
        const acestreamId = acestreamInput.value.trim();
        const hostname = window.location.hostname;
        const streamUrlts = `http://${hostname}/ace/getstream?id=${acestreamId}`;
        const streamUrlhls = `http://${hostname}/ace/manifest.m3u8?id=${acestreamId}`;

        localStorage.setItem('acestreamId', acestreamId);

        if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
          videoElement.src = streamUrlhls;
          videoElement.play();
        } else {
          if (player) {
            player.destroy();
            player = null;
          }

          if (streamUrl && mpegts.getFeatureList().mseLivePlayback) {
            player = mpegts.createPlayer({
              type: 'mse',
              isLive: true,
              url: streamUrlts
            }, {
              enableWorker: true,
              enableStashBuffer: false,
              isLive: true
            });
            
            player.attachMediaElement(videoElement);    
            player.load();
            player.play();
          }
        }
      }
    });
  </script>
</body>
</html>